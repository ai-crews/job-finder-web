<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Job Finder</title>
</head>
<body class="bg-[#F9FAFB]">
<header class="bg-[#56C596] text-white py-14 text-center">
    <h1 class="text-5xl font-bold mb-4">수시 채용공고 확인</h1>
    <p class="text-xl mb-3">'바로가기'를 누르면 자세한 정보를 볼 수 있어요!</p>
</header>

<div class="flex justify-start md:justify-center gap-3 my-10 px-4 overflow-x-auto no-scrollbar">
    <button id="btn-all" onclick="filterJobs('all', this)"
            class="filter-btn whitespace-nowrap px-6 py-2 bg-[#FDE68A] border border-yellow-500 rounded-full text-sm font-bold transition-all">
        전체
    </button>
    <% ['MLE', 'DE', 'DA', 'AI Research', 'AI 기획자'].forEach(tag => { %>
        <button onclick="filterJobs('<%= tag %>', this)"
                class="filter-btn whitespace-nowrap px-6 py-2 bg-[#FEF9C3] border border-[#FDE68A] rounded-full text-sm font-medium hover:bg-[#FDE68A] transition-all">
            <%= tag %>
        </button>
    <% }) %>
</div>

<div class="max-w-5xl mx-auto px-4 mb-4 flex justify-end">
    <select id="sort-select" onchange="sortJobs()"
            class="bg-white border border-gray-200 text-gray-700 py-2 px-4 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[#56C596] cursor-pointer">
        <option value="default">기본순</option>
        <option value="deadline">마감기한순</option>
    </select>
</div>

<main class="max-w-5xl mx-auto px-4 pb-20" id="job-list">
    <% jobs.forEach((job, index) => { %>
        <div class="job-card bg-white border border-gray-100 rounded-2xl p-6 md:p-8 mb-6 flex flex-col md:flex-row items-center shadow-sm transition-all"
             data-job="<%= job[2] %>"
             data-date="<%= job[4] %>"
             data-index="<%= index %>">

            <div class="w-24 h-24 md:w-28 md:h-28 bg-gray-100 flex items-center justify-center rounded-xl mb-4 md:mb-0 md:mr-8 flex-shrink-0 overflow-hidden border border-gray-100">
                <% if (job[9] && job[9].trim() !== '') { %>
                    <img src="<%= job[9] %>" alt="<%= job[0] %> 로고" class="w-full h-full object-contain p-2"
                         onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');">
                    <span class="hidden text-black font-extrabold text-lg text-center"><%= job[0] %></span>
                <% } else { %>
                    <div class="w-full h-full bg-[#FACC15] flex items-center justify-center p-4">
                        <span class="text-black font-extrabold text-lg text-center"><%= job[0] %></span>
                    </div>
                <% } %>
            </div>

            <div class="flex-1 text-center md:text-left mb-6 md:mb-0">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2"><%= job[0] %></h2>
                <div class="space-y-1 text-base md:text-lg">
                    <p class="text-gray-700"><span class="font-bold">모집부문</span> <%= job[1] %></p>
                    <p class="text-gray-700"><span class="font-bold">직무명</span> <%= job[2] %></p>
                </div>
                <div class="mt-4 flex flex-wrap justify-center md:justify-start items-center gap-3">
                    <span class="bg-[#FEF9C3] text-[#854D0E] px-3 py-1 rounded text-xs font-bold"><%= job[3] %></span>
                    <span class="text-xs md:text-sm text-gray-500">접수마감 <%= job[4] %></span>
                </div>
            </div>

            <a href="<%= job[5] %>" target="_blank"
               class="w-full md:w-auto text-center border-2 border-gray-200 px-8 py-3 rounded-xl font-bold text-gray-700 hover:bg-gray-50 transition-colors">
                바로가기
            </a>
        </div>
    <% }) %>
</main>

<div id="pagination" class="flex justify-center gap-2 mt-8 mb-20">
</div>

<footer class="bg-[#56C596] text-white py-24 text-center">
    <h2 class="text-7xl font-black italic mb-4 tracking-tighter">JOB FINDER</h2>
    <p class="text-xl font-medium">당신의 성공적인 커리어를 응원합니다</p>
</footer>

<script>
    let currentPage = 1;
    const itemsPerPage = 10;

    // 페이지를 보여주는 핵심 함수
    function renderPage() {
        // 1. 현재 필터링된(숨겨지지 않은) 카드들만 추출
        const allCards = Array.from(document.querySelectorAll('.job-card'));
        const visibleCards = allCards.filter(card => !card.classList.contains('filtered-out'));

        const totalPages = Math.ceil(visibleCards.length / itemsPerPage);

        // 2. 모든 카드를 일단 숨김
        allCards.forEach(card => card.style.display = 'none');

        // 3. 현재 페이지에 해당하는 카드만 보여줌
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;

        visibleCards.slice(start, end).forEach(card => {
            card.style.display = 'flex';
        });

        // 4. 페이지네이션 버튼 생성
        renderPaginationButtons(totalPages);
    }

    // 하단 숫자 버튼 생성
    function renderPaginationButtons(totalPages) {
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = '';

        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.innerText = i;
            btn.className = `px-4 py-2 rounded-lg border ${i === currentPage ? 'bg-[#56C596] text-white border-[#56C596]' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
            btn.onclick = () => {
                currentPage = i;
                renderPage();
                window.scrollTo(0, 0); // 페이지 이동 시 상단으로 스크롤
            };
            paginationContainer.appendChild(btn);
        }
    }

    // 기존 필터 함수 수정
    function filterJobs(category, element) {
        // 1. 모든 필터 버튼의 스타일을 기본(연한 색)으로 초기화
        const buttons = document.querySelectorAll('.filter-btn');
        buttons.forEach(btn => {
            btn.classList.remove('bg-[#FDE68A]', 'border-yellow-500', 'font-bold');
            btn.classList.add('bg-[#FEF9C3]', 'border-[#FDE68A]', 'font-medium');
        });

        // 2. 현재 클릭된 버튼만 진하게(강조) 변경
        element.classList.remove('bg-[#FEF9C3]', 'font-medium');
        element.classList.add('bg-[#FDE68A]', 'border-yellow-500', 'font-bold');

        // 3. 기존 필터링 로직 수행
        const cards = document.querySelectorAll('.job-card');
        currentPage = 1;

        cards.forEach(card => {
            const jobType = card.getAttribute('data-job');
            if (category === 'all' || jobType.includes(category)) {
                card.classList.remove('filtered-out');
            } else {
                card.classList.add('filtered-out');
            }
        });

        renderPage();
    }

    // 기존 정렬 함수 수정
    function sortJobs() {
        const sortType = document.getElementById('sort-select').value;
        const container = document.getElementById('job-list');
        const cards = Array.from(container.getElementsByClassName('job-card'));

        cards.sort((a, b) => {
            if (sortType === 'deadline') {
                return a.getAttribute('data-date').localeCompare(b.getAttribute('data-date'));
            } else {
                return a.getAttribute('data-index') - b.getAttribute('data-index');
            }
        });

        cards.forEach(card => container.appendChild(card));
        renderPage(); // 정렬 후 다시 그리기
    }

    // index.ejs의 <script> 태그 안에 추가
    window.onload = () => {
        console.log("전체 데이터:", <%- JSON.stringify(jobs) %>);
        renderPage();
    };
</script>
</body>
</html>